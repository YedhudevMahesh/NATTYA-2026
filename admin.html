<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NATTYA 2026 – Admin Panel</title>

<style>
:root{
  --primary:#4b164c;
  --secondary:#9c27b0;
}

body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:linear-gradient(180deg,#f7f3fb,#f0ecf7);
  margin:0;
  color:#333;
}

header{
  background:linear-gradient(135deg,#2c0a2f,var(--primary),var(--secondary));
  color:#fff;
  padding:25px;
  text-align:center;
}

header h1{margin:0;font-size:30px;letter-spacing:1px}
header p{margin:6px 0 0;font-size:14px;opacity:.9}

.container{
  max-width:1000px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}

h2{color:var(--primary);border-left:6px solid var(--secondary);padding-left:12px}

label{display:block;margin-top:14px;font-weight:bold}

input, select, textarea{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  margin-top:15px;
  padding:10px 16px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}

button:hover{opacity:.9}

.secondary-btn{
  background:linear-gradient(135deg,#607d8b,#455a64);
}

.danger-btn{
  background:linear-gradient(135deg,#d32f2f,#b71c1c);
}

table{width:100%;border-collapse:collapse;margin-top:20px}
th, td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:var(--primary);color:#fff}

.hidden{display:none}
.actions button{margin:2px;font-size:12px}

.sync-box{
  margin-top:20px;
  padding:15px;
  background:#f7f3fb;
  border:1px dashed var(--secondary);
  border-radius:10px;
}
</style>
</head>

<body>

<header>
  <h1>NATTYA 2026</h1>
  <p>Admin Result Entry Portal</p>
</header>

<div class="container">

  <h2>Admin Login</h2>
  <input type="password" id="pass" placeholder="Enter Admin Password">
  <button onclick="login()">Login</button>

  <div id="panel" class="hidden">

    <h2>Add / Edit Event Result</h2>

    <label>Event</label>
    <select id="eventSelect">
      <option value="">-- Select Event --</option>
    </select>

    <label>Category</label>
    <select id="category" onchange="toggleGroupParticipants()">
      <option>Individual</option>
      <option>Group</option>
    </select>

    <div id="individualFields">
      <label>Participant Name</label>
      <input id="participant">
    </div>

    <div id="groupFields" class="hidden">
      <label>Group Participants (one per line)</label>
      <textarea id="groupParticipants" rows="4"></textarea>
    </div>

    <label>Department</label>
    <input id="department">

    <label>Year</label>
    <select id="year">
      <option>1st Year</option>
      <option>2nd Year</option>
      <option>3rd Year</option>
      <option>4th Year</option>
    </select>

    <label>Group</label>
    <select id="group">
      <option>Mudhra</option>
      <option>Lasya</option>
      <option>Kavya</option>
    </select>

    <label>Position</label>
    <select id="position">
      <option>First</option>
      <option>Second</option>
      <option>Third</option>
    </select>

    <button onclick="saveResult()">Save / Update Result</button>

    <div class="sync-box">
      <b>Manual Sync</b><br>
      After entering results, click below and upload the file to GitHub.
      <br>
      <button class="secondary-btn" onclick="downloadResults()">Download results.json</button>
      <button class="secondary-btn" onclick="importResults()">Import results.json</button>
      <input type="file" id="fileInput" accept="application/json" class="hidden">
    </div>

    <h2>Saved Results</h2>
    <table>
      <thead>
        <tr>
          <th>Event</th>
          <th>Participant(s)</th>
          <th>Group</th>
          <th>Position</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminResults"></tbody>
    </table>

    <button class="danger-btn" onclick="clearAllResults()">Clear All Results</button>

  </div>

</div>

<script>
const PASSWORD = "festival123";
let editIndex = null;

const events = [
  "Light Music Vocal (Indian) – Male","Light Music Vocal (Indian) – Female","Light Music Vocal (Indian) – Transgender",
  "Classical Music Vocal – Male","Classical Music Vocal – Female","Classical Music Vocal – Transgender",
  "Stringed Instrument – Eastern Style","Stringed Instrument – Western Style",
  "Wind Instrument – Eastern Style","Wind Instrument – Western Style",
  "Percussion Instrument – Eastern Style","Percussion Instrument – Western Style",
  "Western Vocal Solo","Group Song (Indian)","Group Song (Western)",
  "Vanchipattu","Mappilapattu","Nadappattu","Folk Orchestra",
  "Kathakali","Bharathanatyam – Male","Bharathanatyam – Female","Bharathanatyam – Transgender","Mohiniyattam",
  "Folk Dance (Individual) – Male","Folk Dance (Individual) – Female","Folk Dance (Individual) – Transgender","Folk Dance (Group)",
  "Margamkali","Oppana","Thiruvathirakali","Other Forms of Classical Dances","Ottanthullal","Keralanatanam","Duffmuttu","Kolkali",
  "Kuchipudi – Male","Kuchipudi – Female","Kuchipudi – Transgender","Nagyarkoothu – Female",
  "Elocution – Malayalam","Elocution – English","Elocution – Hindi","Elocution – Tamil",
  "Essay Writing – English","Essay Writing – Malayalam","Essay Writing – Hindi","Essay Writing – Tamil","Essay Writing – Arabic","Essay Writing – Sanskrit",
  "Short Story Writing – English","Short Story Writing – Malayalam","Short Story Writing – Hindi","Short Story Writing – Tamil","Short Story Writing – Arabic","Short Story Writing – Sanskrit",
  "Poetry Writing – English","Poetry Writing – Malayalam","Poetry Writing – Hindi","Poetry Writing – Tamil","Poetry Writing – Sanskrit",
  "Quiz","Aksharaslokam","Kavikaleli","Kavithaparayanam (Malayalam)",
  "Poetry Recitation – English","Poetry Recitation – Hindi","Poetry Recitation – Tamil","Poetry Recitation – Arabic",
  "Film Review","Kathaprasangam","Debate – English","Debate – Malayalam",
  "Mono Act","Mimicry","Mime","Skit","One Act Play","Parichamuttu","Chakyarkoothu – Male",
  "Standup Comedy","On the Spot Painting","Collage","Poster Designing","Clay Modeling","Cartooning","Photography","Installation","Rangoli","Mehendi"
];

const points = {
  Individual:{First:5, Second:3, Third:1},
  Group:{First:10, Second:6, Third:2}
};

window.onload = function(){
  const eventSelect = document.getElementById("eventSelect");
  events.forEach(e=>{
    let opt = document.createElement("option");
    opt.value = e;
    opt.textContent = e;
    eventSelect.appendChild(opt);
  });
  loadAdminResults();
};

function login(){
  if(pass.value === PASSWORD){
    panel.classList.remove("hidden");
    loadAdminResults();
  } else {
    alert("Wrong password");
  }
}

function toggleGroupParticipants(){
  const isGroup = category.value === "Group";
  groupFields.classList.toggle("hidden", !isGroup);
  individualFields.classList.toggle("hidden", isGroup);
}

function saveResult(){
  const eventName = eventSelect.value;
  if(!eventName){alert("Please select an event");return;}

  const categoryVal = category.value;
  const positionVal = position.value;
  const groupName = group.value;
  const pts = points[categoryVal][positionVal];

  let participants = [];
  let participantName = participant.value;

  if(categoryVal === "Group"){
    participants = groupParticipants.value.split("\n").map(p=>p.trim()).filter(p=>p);
    participantName = participants.join(", ");
  }

  let data = JSON.parse(localStorage.getItem("nattya") || "[]");
  data = data.filter(r => !(r.event === eventName && r.position === positionVal));

  const obj = {event:eventName,participant:participantName,participants:participants,department:department.value,year:year.value,group:groupName,category:categoryVal,position:positionVal,points:pts};

  if(editIndex !== null){data[editIndex] = obj;editIndex = null;} else {data.push(obj);}  

  localStorage.setItem("nattya", JSON.stringify(data));
  clearForm();
  loadAdminResults();
  alert("Result saved successfully");
}

function loadAdminResults(){
  let data = JSON.parse(localStorage.getItem("nattya") || "[]");
  adminResults.innerHTML = "";
  data.forEach((d,i)=>{
    let r = adminResults.insertRow();
    r.insertCell(0).innerText = d.event;
    r.insertCell(1).innerText = d.participant;
    r.insertCell(2).innerText = d.group;
    r.insertCell(3).innerText = d.position;
    let act = r.insertCell(4);
    act.innerHTML = `<button onclick="editResult(${i})">Edit</button> <button onclick="deleteResult(${i})">Delete</button>`;
  });
}

function editResult(i){
  let data = JSON.parse(localStorage.getItem("nattya") || "[]");
  let d = data[i];
  editIndex = i;
  eventSelect.value = d.event;
  category.value = d.category;
  toggleGroupParticipants();
  participant.value = d.participant;
  department.value = d.department;
  year.value = d.year;
  group.value = d.group;
  position.value = d.position;
  if(d.category === "Group"){groupParticipants.value = (d.participants || []).join("\n");}
}

function deleteResult(i){
  if(confirm("Delete this result?")){
    let data = JSON.parse(localStorage.getItem("nattya") || "[]");
    data.splice(i,1);
    localStorage.setItem("nattya", JSON.stringify(data));
    loadAdminResults();
  }
}

function clearForm(){participant.value="";department.value="";groupParticipants.value=""}

// -------- Manual Sync --------
function downloadResults(){
  let data = localStorage.getItem("nattya") || "[]";
  let blob = new Blob([data], { type: "application/json" });
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "results.json";
  a.click();
  URL.revokeObjectURL(url);
  alert("results.json downloaded. Upload it to GitHub.");
}

function importResults(){
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(evt){
    try{
      let data = JSON.parse(evt.target.result);
      localStorage.setItem("nattya", JSON.stringify(data));
      loadAdminResults();
      alert("Results imported successfully");
    } catch(err){
      alert("Invalid results.json file");
    }
  };
  reader.readAsText(file);
});

function clearAllResults(){
  if(confirm("This will delete all results locally. Continue?")){
    localStorage.removeItem("nattya");
    loadAdminResults();
  }
}
</script>

</body>
</html>
